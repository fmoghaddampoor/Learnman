@page "/"
@layout Learnman.Components.Layout.AuthLayout
@inject NavigationManager Navigation

@inject Learnman.Services.AuthService AuthService
@rendermode InteractiveServer

<PageTitle>Login - Learnman</PageTitle>

<div class="login-form animate-fade-in">
    @if (!string.IsNullOrEmpty(ErrorMessage))
    {
         <div class="alert-error">@ErrorMessage</div>
    }

    <div class="form-group">
        <label>Email</label>
        <input type="email" @bind="Email" placeholder="you@example.com" />
    </div>
    
    <div class="form-group">
        <label>Password</label>
        <div class="password-wrapper">
             <input type="@(ShowPassword ? "text" : "password")" @bind="Password" placeholder="••••••••" />
             <button type="button" class="toggle-password" @onclick="TogglePassword">
                 @(ShowPassword ? "Hide" : "Show")
             </button>
        </div>
    </div>

    <button class="btn-primary w-100" @onclick="HandleLogin">
        Start Your Journey
    </button>
    
    <button class="btn-secondary w-100 mt-2" @onclick="FastLogin">
        ⚡ Fast Login (Dev)
    </button>
    
    <div class="mt-4">
        <p class="text-sm">New here? <a href="register" class="text-gradient hover:underline">Create an account</a></p>
    </div>
</div>

<style>
    .form-group {
        text-align: left;
        margin-bottom: 20px;
    }
    
    .form-group label {
        display: block;
        margin-bottom: 8px;
        color: var(--text-secondary);
        font-size: 0.9rem;
    }

    .password-wrapper {
        position: relative;
    }
    
    .toggle-password {
        position: absolute;
        right: 10px;
        top: 50%;
        transform: translateY(-50%);
        background: transparent;
        border: none;
        color: var(--accent-primary);
        cursor: pointer;
        font-size: 0.8rem;
    }
    
    .alert-error {
        background: rgba(236, 72, 153, 0.2);
        color: #ec4899;
        padding: 10px;
        border-radius: var(--radius-sm);
        margin-bottom: 20px;
        font-size: 0.9rem;
    }

    .w-100 { width: 100%; }
    .mt-4 { margin-top: 1.5rem; }
    .mt-2 { margin-top: 0.5rem; }
    .text-sm { font-size: 0.875rem; }
    
    .btn-secondary {
        background: transparent;
        color: var(--text-secondary);
        border: 1px solid var(--border-glass);
        padding: 12px;
        border-radius: var(--radius-sm);
        cursor: pointer;
        transition: all 0.2s;
        font-weight: 500;
    }
    
    .btn-secondary:hover {
        background: var(--bg-glass);
        color: var(--text-primary);
        border-color: var(--accent-primary);
    }
</style>

@code {
    private string Email = "";
    private string Password = "";
    private string ErrorMessage = "";
    private bool ShowPassword = false;

    private void TogglePassword()
    {
        ShowPassword = !ShowPassword;
    }

    private void FastLogin()
    {
        Email = "test@test.com";
        Password = "test";
    }

    private async Task HandleLogin()
    {
        try
        {
             var user = await AuthService.LoginAsync(Email, Password);
             if (user != null)
             {
                 // In a real app we would set a cookie here.
                 // For this demo, we just navigate. State is 'session-like'.
                 Navigation.NavigateTo("/onboarding");
             }
             else
             {
                 ErrorMessage = "Invalid credentials";
             }
        }
        catch (Exception ex)
        {
             ErrorMessage = ex.Message;
        }
    }
}
