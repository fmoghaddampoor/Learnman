@page "/db-viewer"
@using Learnman.Data
@using Learnman.Models
@using Microsoft.EntityFrameworkCore
@inject AppDbContext DbContext
@attribute [StreamRendering]

<PageTitle>DB Viewer - Learnman</PageTitle>

<div class="db-container animate-fade-in">
    <h1>Database Viewer</h1>
    <p>Current Users in <code>learnman.db</code></p>
    
    <div class="table-responsive glass-panel">
        <table class="table">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Name</th>
                    <th>Email</th>
                    <th>Native</th>
                    <th>Target</th>
                    <th>Location</th>
                </tr>
            </thead>
            <tbody>
                @if (Users == null)
                {
                    <tr><td colspan="6">Loading...</td></tr>
                }
                else if (!Users.Any())
                {
                    <tr><td colspan="6">No users found.</td></tr>
                }
                else
                {
                    @foreach (var user in Users)
                    {
                        <tr>
                            <td>@user.Id</td>
                            <td>@user.FirstName @user.LastName</td>
                            <td>@user.Email</td>
                            <td>@user.NativeLanguage</td>
                            <td>@user.TargetLanguage</td>
                            <td>@user.Location</td>
                        </tr>
                    }
                }
            </tbody>
        </table>
    </div>
    
    <div class="actions">
        <a href="/" class="btn-secondary">Back to App</a>
        <button class="btn-primary" @onclick="Refresh">Refresh</button>
    </div>
</div>

<style>
    .db-container {
        padding: 40px;
        max-width: 1200px;
        margin: 0 auto;
        color: white;
    }
    
    .table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
    }
    
    .table th, .table td {
        padding: 15px;
        text-align: left;
        border-bottom: 1px solid rgba(255,255,255,0.1);
    }
    
    .table th {
        color: var(--accent-primary);
        font-weight: 600;
    }
    
    .actions {
        margin-top: 30px;
        display: flex;
        gap: 20px;
    }
</style>

@code {
    private List<User> Users = new();

    protected override async Task OnInitializedAsync()
    {
        await LoadUsers();
    }

    private async Task LoadUsers()
    {
        // Simple fetch
        Users = await DbContext.Users.ToListAsync();
    }
    
    private async Task Refresh()
    {
        await LoadUsers();
    }
}
